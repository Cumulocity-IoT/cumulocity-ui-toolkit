<c8y-modal
  [labels]="labels"
  [disabled]="type === 'Unset' || !layer.name"
  (onClose)="onClose()"
  (onDismiss)="onDismiss()"
  title="{{ title | translate }}"
  style="width: 100%"
>
  <div class="m-16">
    <div class="legend form-block center">General</div>
    <div class="form-group">
      <label translate for="layerName">Name</label>
      <input
        class="form-control"
        id="layerName"
        [(ngModel)]="layer.name"
        [maxlength]="254"
        type="text"
        name="layerName"
      />
    </div>
    <div class="legend form-block center">Marker</div>
    <div class="form-group">
      <label translate for="iconInput">Icon</label>
      <div class="input-group">
        <div class="input-group-btn">
          <button class="btn btn-primary" (click)="openIconModal()">Pick icon</button>
        </div>
        <input
          class="form-control"
          id="iconInput"
          [(ngModel)]="layer.icon"
          type="text"
          name="iconInput"
        />
        <span class="input-group-addon" *ngIf="layer.icon"><i [c8yIcon]="layer.icon"></i></span>
      </div>
    </div>
    <div
      class="form-group"
      *ngIf="
        !((type === 'QueryLayerConfig' && queryType === 'Alarm') || type === 'WebMapServiceLayer')
      "
    >
      <label translate for="iconColorInput">Icon Color</label>
      <div
        class="form-control"
        style="width: 36px; cursor: pointer"
        title="Click to select a marker color."
      >
        <div class="c8y-colorpicker">
          <input
            id="iconColorInput"
            [(ngModel)]="layer.color"
            [attr.aria-label]="'Color' | translate"
            (click)="$event.stopPropagation()"
            type="color"
          />
          <span [style.background-color]="layer.color"></span>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label translate for="layerType">Layer Type</label>
      <div class="c8y-select-wrapper" title="{{ 'Select type' | translate }}">
        <select
          class="btn btn-default dropdown-toggle c8y-dropdown"
          id="layerType"
          #typeSelect
          (change)="changeType(typeSelect.value)"
          required="true"
        >
          <option value="" selected disabled>Select a type</option>
          <option
            [selected]="type === 'QueryLayerConfig' && queryType === 'Inventory'"
            value="InventoryQueryLayerConfig"
          >
            {{ 'Inventory Query' | translate }}
          </option>
          <option
            [selected]="type === 'QueryLayerConfig' && queryType === 'Alarm'"
            value="AlarmQueryLayerConfig"
          >
            {{ 'Alarm Query' | translate }}
          </option>
          <option
            [selected]="type === 'QueryLayerConfig' && queryType === 'Event'"
            value="EventQueryLayerConfig"
          >
            {{ 'Event Query' | translate }}
          </option>
          <option [selected]="type === 'WebMapServiceLayer'" value="WebMapServiceLayer">
            {{ 'Web Map Service (WMS)' | translate }}
          </option>
        </select>
      </div>
    </div>
    <span *ngIf="type === 'QueryLayerConfig'">
      <div class="legend form-block center">{{ queryType }} Query Configuration</div>
      <inventory-query-form
        *ngIf="queryType === 'Inventory'"
        [filter]="layer.filter"
      ></inventory-query-form>
      <alarm-query-form *ngIf="queryType === 'Alarm'" [filter]="layer.filter"></alarm-query-form>
      <event-query-form *ngIf="queryType === 'Event'" [filter]="layer.filter"></event-query-form>
    </span>

    <span *ngIf="type === 'WebMapServiceLayer'">
      <div class="legend form-block center">Web Map Service</div>
      <div class="form-group">
        <label for="url" translate>URL</label>
        <input
          class="form-control"
          id="url"
          [(ngModel)]="layer.url"
          (ngModelChange)="onWmsURLChange($event)"
          name="url"
          type="url"
          placeholder="http://ows.mundialis.de/services/service?"
          required
        />
      </div>
      <ul class="list-unstyled">
        <label translate>WMS Layers</label>
        <li class="m-b-8" *ngFor="let item of layer.wmsLayers; let i = index">
          <c8y-input-group-list
            [index]="i"
            (onAdd)="addWMSLayer()"
            (onRemove)="removeWMSLayer($event)"
          >
            <input
              class="form-control m-r-4"
              [(ngModel)]="item.name"
              [required]="true"
              type="text"
              name="wsLayer"
              placeholder="{{ 'WMS Layer, e.g. TOPO-OSM-WMS' | translate }}"
              style="flex-grow: 2"
          /></c8y-input-group-list>
        </li>
      </ul>

      <div class="form-group">
        <label for="username" translate>Username</label>
        <input
          class="form-control"
          id="username"
          [(ngModel)]="wmsCredentials.username"
          name="username"
          type="text"
        />
      </div>
      <div class="form-group">
        <label for="password" translate>Password</label>
        <input
          class="form-control"
          id="password"
          [(ngModel)]="wmsCredentials.password"
          name="password"
          type="password"
        />
      </div>
      <button
        class="btn btn-danger"
        *ngIf="layer.token"
        (click)="clearAllPasswords()"
        type="button"
      >
        {{ 'Clear all passwords' | translate }}
      </button>
    </span>

    <div class="legend form-block center" *ngIf="type === 'QueryLayerConfig'">Polling</div>

    <div class="row d-flex a-i-center" *ngIf="type === 'QueryLayerConfig'">
      <div class="col-xs-6">
        <div class="form-group m-b-0 form-group-sm">
          <label class="control-label" for="positionPolling">{{ 'Polling' | translate }}</label>
          <div class="c8y-select-wrapper">
            <select class="form-control" id="positionPolling" [(ngModel)]="layer.enablePolling">
              <option value="false" title="Only refreshing on interaction">
                No automatic polling
              </option>
              <option value="true" title="Refreshing after a give interval and on interaction">
                Activate polling
              </option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-xs-6">
        <div class="form-group form-group-sm m-b-0">
          <label class="control-label" for="pollingSlider">{{
            'Polling interval in seconds' | translate
          }}</label>
          <c8y-range
            class="label-bottom"
            [(ngModel)]="layer.pollingInterval"
            [disabled]="!(layer.enablePolling | stringToBool)"
          >
            <input
              id="pollingSlider"
              [disabled]="!(layer.enablePolling | stringToBool)"
              type="range"
              min="1"
              max="180"
              step="1"
            />
          </c8y-range>
        </div>
      </div>
    </div>
  </div>
</c8y-modal>
