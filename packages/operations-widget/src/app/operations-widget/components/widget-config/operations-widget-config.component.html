<div class="form-group">
    <label>Define Operation Buttons</label>
@if (config.device) {
  @if (config?.buttons?.length) {
    @for (item of config.buttons; let buttonIndex = $index; track $index) {

      <div class="row button-config">
        @if (config.buttons.length >= 2) {
          <h5 class="col-sm-12 m-b-4">{{ buttonIndex + 1 }}. Button</h5>
        }
  
        <!-- supported ops -->
        @if (supportedOperations.length > 0) {
          <div class="col-sm-6">
            <div class="form-group">
              <label translate for="operation_{{ $index }}">Supported Operations</label>
              <div class="c8y-select-wrapper">
                <select
                  class="form-control"
                  id="operation_{{ $index }}"
                  [(ngModel)]="item.operationFragment"
                  name="operation"
                >
                  @for (op of supportedOperations; track op) {
                    <option [attr.selected]="op === item.operationFragment || null">{{ op }}</option>
                  }
                </select>
              </div>
            </div>
          </div>
        } @else {
          <div class="col-sm-6">
          <c8y-form-group [hasWarning]="!item.operationFragment || item.operationFragment.length === 0">
            <label translate for="label_{{ $index }}">Supported Operation</label>
            <input
              class="form-control"
              [(ngModel)]="item.operationFragment"
              [maxlength]="254"
              type="text"
              autocomplete="off"
              placeholder="e.g. c8y_Command"
              required
            />
            <c8y-messages>
              <c8y-message *ngIf="!item.operationFragment || item.operationFragment.length === 0" translate></c8y-message>
              <c8y-message name="required" text="'Supoorted operation is required'"></c8y-message>
            </c8y-messages>
          </c8y-form-group>
        </div>
        }
  
        <!-- label -->
        <div class="col-sm-6">
          <c8y-form-group [hasWarning]="!item.label || item.label.length === 0">
            <label translate for="label_{{ $index }}">Label</label>
            <input
              class="form-control"
              id="label_{{ $index }}"
              [(ngModel)]="item.label"
              [maxlength]="254"
              type="text"
              name="label"
              autocomplete="off"
              placeholder="e.g. Restart"
              required
            />
            <c8y-messages>
              <c8y-message *ngIf="!item.label || item.label.length === 0" translate></c8y-message>
              <c8y-message name="required" text="'The label is required'"></c8y-message>
            </c8y-messages>
          </c8y-form-group>
        </div>
  
        <!-- icon -->
        <div class="col-sm-6">
          <c8y-form-group>
            <label translate for="buttonClasses_{{ $index }}">Button Icon</label>
            <div class="dropdown" style="width: 100%" dropdown>
              <button
                class="btn btn-default dropdown-toggle c8y-dropdown"
                type="button"
                title="Icon for button"
                style="width: 100%"
                dropdownToggle
              >
                <span
                  ><i [c8yIcon]="item.icon || 'refresh'"></i>
                  {{ item.icon ? item.icon : 'Choose Icon' }}</span
                >
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" *dropdownMenu>
                <li *ngFor="let iconClass of availableIcons" (click)="item.icon = iconClass">
                  <button type="button"><i [c8yIcon]="iconClass"></i> {{ iconClass }}</button>
                </li>
              </ul>
            </div>
          </c8y-form-group>
        </div>
  
        <!-- color -->
        <div class="col-sm-6">
          <c8y-form-group>
            <label translate for="buttonColors">Button Color</label>
            <div class="dropdown" style="width: 100%" dropdown>
              <button
                [ngClass]="
                  'btn btn-default dropdown-toggle c8y-dropdown ' +
                  (item.buttonClasses || 'btn-warning')
                "
                type="button"
                title="Color of the button"
                style="width: 100%"
                dropdownToggle
              >
                <span>{{ item.buttonClasses ? item.buttonClasses : 'Choose Color' }}</span>
                <span class="caret"></span>
              </button>
  
              <ul class="dropdown-menu" *dropdownMenu>
                <li *ngFor="let class of buttonClasses" (click)="item.buttonClasses = class">
                  <button type="button">
                    <i [c8yButton]="item.button"></i>
                    {{ class }}
                  </button>
                </li>
              </ul>
            </div>
          </c8y-form-group>
        </div>

         <!-- description -->
        <div class="col-sm-12">
          <c8y-form-group [hasWarning]="!item.description || item.description.length === 0">
            <label translate for="description_{{ $index }}">Description</label>
            <input
              class="form-control"
              id="description_{{ $index }}"
              [(ngModel)]="item.description"
              [maxlength]="254"
              type="text"
              name="description"
              autocomplete="off"
              placeholder="e.g. Manually triggered device restart"
              required
            />
          </c8y-form-group>
        </div>

      

          <!-- operation value -->
         @if (item.operationFragment && item.operationValue) {
           <div class="col-sm-12 m-b-8" style="height: 200px; border: 1px solid var(--c8y-component-border-color, var(--c8y-root-component-border-color))">
             <operations-editor [(value)]="item.operationValue" (valueChange)="onOperationBodyChanged($event, buttonIndex)" [supportedOperation]="item.operationFragment"></operations-editor>
           </div>
         }
     
          <div class="col-sm-12 m-t-32">
          <c8y-form-group>
            <label>Placeholders</label>
            @for (field of config.buttons[buttonIndex].fields; let i = $index; track $index) {
              <div class="card p-8 bg-gray-lighter m-b-4 animated fadeIn">
                
                <div class="d-flex gap-8">
                  <input class="form-control" [(ngModel)]="field.key" placeholder="Key" disabled>
                  <input class="form-control" [(ngModel)]="field.label" placeholder="Label">
                  
                  <div class="c8y-select-wrapper">
                     <select class="form-control" [(ngModel)]="field.type" style="width: 120px;">
                        <option value="input">Text</option>
                        <option value="number">Number</option>
                        <option value="select">Dropdown</option>
                     </select>
                  </div>
                </div>
        
                @if (field.type === 'select') {
                  <div class="p-4">
                    <label>Dropdown Options</label>
                    
                    @for (opt of field.options; let j = $index; track $index) {
                      <div class="d-flex gap-8 m-b-8">
                        <input class="form-control input-sm" [(ngModel)]="opt.label" placeholder="Label">
                        <input class="form-control input-sm" [(ngModel)]="opt.value" placeholder="Value">
                        <button class="btn btn-clean btn-xs" (click)="removeOption(field, j)"><i c8yIcon="minus-circle"></i></button>
                      </div>
                    }
                    
                    <button class="btn btn-default" (click)="addOption(field)">
                      <i c8yIcon="plus"></i> Add Option
                    </button>
                  </div>
                }
        
              </div>
            }
      
          </c8y-form-group>
        
      </div>
      
  
        
  
        <!-- confirmation -->
        @if (config.buttons[buttonIndex].fields?.length === 0) {
          <div class="col-sm-12">
            <c8y-form-group>
              <label translate for="confirmation_{{ $index }}">Requires confirmation</label>
              <label class="c8y-switch" title="{{ 'Active' | translate }}">
                <input [(ngModel)]="item.showModal" type="checkbox" />
                <span></span>
                <span>
                  {{ 'Confirm operation' }}
                </span>
              </label>
              <input
                class="form-control"
                id="confirmation_{{ $index }}"
                *ngIf="item.showModal"
                [(ngModel)]="item.modalText"
                [maxlength]="254"
                type="text"
                name="description"
                autocomplete="off"
                placeholder="e.g. Restart device"
              />
            </c8y-form-group>
          </div>
        }
  
        <!-- admin -->
        <div class="col-sm-12">
          <button class="btn btn-danger" (click)="removeButton(buttonIndex)">
            <i c8yIcon="delete"></i>Delete Button
          </button>
          <hr />
        </div>
      </div>
    }

        <!-- preview -->
    <div class="form-group">
      <label>Preview</label>
    </div>
    <div class="col-sm-12 preview">
      @if (config?.buttons?.length) {
        @for (button of config.buttons; track button) {
          <button-instance [config]="button" [preview]="true"></button-instance>
        }
      }
</div>
  } @else {
      <button class="m-t-16 btn btn-primary" (click)="addNewButton()">
        <i c8yIcon="plus"></i>
        {{ 'Add First Button' | translate }}
      </button>
  }
} @else {
  <h3 class="m-b-16" translate>Define Operation Buttons</h3>
  <h4 translate>Before we can start you have to pick a device</h4>
}

@if (config?.buttons?.length > 0) {
  <button class="m-t-8 m-b-8 btn btn-primary" (click)="addNewButton()">
    <i c8yIcon="plus"></i>
    {{ 'Add Button' | translate }}
  </button>
}


</div>
